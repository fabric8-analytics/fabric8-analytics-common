Feature: Vulnerability Analysis and get token

    @API-2.2 
    Scenario Outline: Check that vulnerablity analysis REST API endpoint  for <method> HTTP method without user key
        Given System is running
        When I access the /api/v2/vulnerability-analysis endpoint using the HTTP <method> method without user key
        Then I should not get 200 status code
        When I access the /api/v2/get-token endpoint using the HTTP <method> method without user key
        Then I should not get 200 status code

        Examples: HTTP methods
         | method |
         | GET    |
         | HEAD   |
         | PUT    |
         | DELETE |
    
    @API-2.2 
    Scenario Outline: Check that vulnerablity analysis REST API endpoint for  for <method> HTTP method with user key
        Given System is running
        Given Three scale preview service is running
        When I acquire the use_key for 3scale
        Then I should get the proper user_key
        When I access the /api/v2/vulnerability-analysis endpoint using the HTTP <method> method without user key
        Then I should not get 200 status code
        When I access the /api/v2/get-token endpoint using the HTTP <method> method without user key
        Then I should not get 200 status code

        Examples: HTTP methods
         | method |
         | GET    |
         | HEAD   |
         | PUT    |
         | DELETE |

    @API-2.2
    Scenario: Check that the API entry point with invalid/without user key
        Given System is running
        Given Three scale preview service is running
        When I acquire the use_key for 3scale
        Then I should get the proper user_key
        When I start vulnerablity analysis for test_npm.json without user_key
        Then I should get 403 status code

    @API-2.2
    Scenario: Check that the API entry point with user key
        Given System is running
        Given Three scale preview service is running
        When I acquire the use_key for 3scale
        Then I should get the proper user_key
        When I start vulnerablity analysis for test_npm.json with user_key
        Then I should get 200 status code
         And I should receive a valid JSON response

    @API-2.2
    Scenario: Check the vulnerablity analysis V2 REST API Batch Call for unknown ecosystem
        Given System is running
        Given Three scale preview service is running

        When I acquire the use_key for 3scale
        Then I should get the proper user_key
        When I start vulnerablity analysis for invalid_ecosystem.json with user_key
        Then I should get 400 status code
         And I should receive a valid JSON response

    
    @API-2.2
    Scenario: Check the vulnerablity analysis V2 REST API Batch Call for unknown packages
        Given System is running
        Given Three scale preview service is running

        When I acquire the use_key for 3scale
        Then I should get the proper user_key
        When I start vulnerablity analysis for invalid_packages.json with user_key
        Then I should get 200 status code
         And I should receive a valid JSON response
        Then I should not find any vulnerabilities in the Result

    @API-2.2
    Scenario: Check the vulnerablity analysis V2 REST API Batch Call for 1 known 1 unknown package
        Given System is running
        Given Three scale preview service is running

        When I acquire the use_key for 3scale
        Then I should get the proper user_key
        When I start vulnerablity analysis for one_known_one_unknown.json with user_key
        Then I should get 200 status code
         And I should receive a valid JSON response
        Then I should be able to find all feilds in the result
        Then I should find pkg angular and version 1.0.0 with vulnerablity id SNYK-JS-ANGULAR-10174 and severity high in Result
         

    @API-2.2
    Scenario: Check the vulnerablity analysis V2 REST API Batch Call for No vulnerablities
        Given System is running
        Given Three scale preview service is running

        When I acquire the use_key for 3scale
        Then I should get the proper user_key
        When I start vulnerablity analysis for no_vulnerablities.json with user_key
        Then I should get 200 status code
         And I should receive a valid JSON response
        Then I should be able to find all feilds in the result
        Then I should not find any vulnerabilities in the Result
    

    @API-2.2
    Scenario: Check the vulnerablity analysis V2 REST API Batch Call for an invalid request
        Given System is running
        Given Three scale preview service is running

        When I acquire the use_key for 3scale
        Then I should get the proper user_key
        When I start vulnerablity analysis for invalid_request.json with user_key
        Then I should get 400 status code
         And I should receive a valid JSON response

    @API-2.2
    Scenario: Check the vulnerability anaysis V2 REST API call for NPM ecosystem
        Given System is running
        Given Three scale preview service is running

        When I acquire the use_key for 3scale
        Then I should get the proper user_key
        When I start vulnerablity analysis for test_npm.json with user_key
        Then I should get 200 status code
         And I should receive a valid JSON response
        Then I should be able to find all feilds in the result
        And I should find pkg angular and version 1.0.0 with vulnerablity id SNYK-JS-ANGULAR-10174 and severity high in Result
        And I should find pkg marked and version 0.3.4 with vulnerablity id SNYK-JS-MARKED-10377 and title Cross-site Scripting (XSS) in Result
        Then I should find no vulnerablities in Result for package sequence and version 3.0.0
        Then I should find pkg mongoose and version 4.2.4 with id SNYK-JS-MONGOOSE-10081 and a fixed in 4.3.6

    @API-2.2 
    Scenario:  Check the vulnerability anaysis V2 REST API call for Maven ecosystem
        Given System is running
        Given Three scale preview service is running

        When I acquire the use_key for 3scale
        Then I should get the proper user_key
        When I start vulnerablity analysis for test_maven.json with user_key
        Then I should get 200 status code
         And I should receive a valid JSON response
        Then I should be able to find all feilds in the result
        And I should find pkg org.webjars:bootstrap-select and version 1.7.3 with vulnerablity id SNYK-JAVA-ORGWEBJARS-479517 and severity high in Result
        And I should find pkg io.vertx:vertx-core and version 3.5.3 with vulnerablity id SNYK-JAVA-IOVERTX-72443 and title Denial of Service (DoS) in Result
        Then I should find no vulnerablities in Result for package org.apache.tomcat:tomcat-catalina and version 10.0.0-M5
        Then I should find pkg org.webjars.npm:openpgp and version 1.4.1 with id SNYK-JAVA-ORGWEBJARSNPM-480072 and a fixed in 4.2.0
        